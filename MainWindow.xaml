<Window x:Class="AudioTranscriber.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:vm="clr-namespace:AudioTranscriber.ViewModels"
        mc:Ignorable="d"
        Title="âœ¨ è¯­éŸ³è½¬å†™å§¬" 
        Height="700" Width="850"
        MinHeight="500" MinWidth="600"
        WindowStartupLocation="CenterScreen"
        Background="#FF1A1A2E"
        Foreground="#FFE0E0E0"
        FontFamily="Microsoft YaHei, SimHei, sans-serif">
    
    <Window.DataContext>
        <vm:MainViewModel/>
    </Window.DataContext>

    <Window.Resources>
        <!-- æ¸å˜èƒŒæ™¯ -->
        <LinearGradientBrush x:Key="AnimeGradient" StartPoint="0,0" EndPoint="1,1">
            <GradientStop Color="#FF1A1A2E" Offset="0"/>
            <GradientStop Color="#FF16213E" Offset="0.5"/>
            <GradientStop Color="#FF0F3460" Offset="1"/>
        </LinearGradientBrush>

        <LinearGradientBrush x:Key="PinkGradient" StartPoint="0,0" EndPoint="1,0">
            <GradientStop Color="#FFFF6B9D" Offset="0"/>
            <GradientStop Color="#FFFF8E53" Offset="1"/>
        </LinearGradientBrush>

        <!-- æŒ‰é’®æ ·å¼ - äºŒæ¬¡å…ƒé£Ž -->
        <Style x:Key="AnimeButton" TargetType="Button">
            <Setter Property="Background" Value="{StaticResource PinkGradient}"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="15,8"/>
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}" 
                                CornerRadius="20"
                                BorderBrush="White"
                                BorderThickness="2">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#FFFF8E53"/>
                    <Setter Property="Effect">
                        <Setter.Value>
                            <DropShadowEffect Color="#FFFF6B9D" BlurRadius="15" ShadowDepth="0"/>
                        </Setter.Value>
                    </Setter>
                </Trigger>
                <Trigger Property="IsPressed" Value="True">
                    <Setter Property="Background" Value="#FFE85D8A"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <!-- å½•åˆ¶æŒ‰é’®æ ·å¼ -->
        <Style x:Key="RecordButton" TargetType="Button" BasedOn="{StaticResource AnimeButton}">
            <Setter Property="Width" Value="70"/>
            <Setter Property="Height" Value="70"/>
        </Style>

        <!-- å­—å¹•é¡¹æ ·å¼ -->
        <DataTemplate x:Key="TranscriptItemTemplate">
            <Border Margin="3" Padding="12" CornerRadius="12"
                    Background="#22FFFFFF"
                    BorderBrush="#44FFFFFF"
                    BorderThickness="1">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    
                    <!-- åŽŸæ–‡ -->
                    <TextBlock Grid.Row="0" 
                               Text="{Binding OriginalText}"
                               Foreground="White"
                               FontSize="15"
                               TextWrapping="Wrap"
                               FontWeight="SemiBold"/>
                    
                    <!-- ç¿»è¯‘ï¼ˆä»…è‹±æ–‡æ˜¾ç¤ºï¼‰ -->
                    <Border Grid.Row="1" 
                            Margin="0,6,0,0" 
                            Padding="8,5" 
                            CornerRadius="8"
                            Background="#33FF6B9D"
                            Visibility="{Binding IsEnglish, Converter={StaticResource BooleanToVisibilityConverter}}">
                        <TextBlock Text="{Binding TranslatedText}"
                                   Foreground="#FFFFD1DC"
                                   FontSize="13"
                                   TextWrapping="Wrap"/>
                    </Border>
                </Grid>
            </Border>
        </DataTemplate>

        <!-- éŸ³é¢‘ç”µå¹³æ¡æ ·å¼ -->
        <Style x:Key="AudioLevelBar" TargetType="ProgressBar">
            <Setter Property="Height" Value="6"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Background" Value="#33000000"/>
            <Setter Property="Foreground">
                <Setter.Value>
                    <LinearGradientBrush StartPoint="0,0" EndPoint="1,0">
                        <GradientStop Color="#FF00D4AA" Offset="0"/>
                        <GradientStop Color="#FFFF6B9D" Offset="0.5"/>
                        <GradientStop Color="#FFFF0000" Offset="1"/>
                    </LinearGradientBrush>
                </Setter.Value>
            </Setter>
        </Style>

        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
    </Window.Resources>

    <Grid Background="{StaticResource AnimeGradient}">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- æ ‡é¢˜æ  -->
        <Border Grid.Row="0" Padding="15,10">
            <Grid>
                <TextBlock Text="ðŸŽ™ï¸ è¯­éŸ³è½¬å†™å§¬" 
                          FontSize="24" 
                          FontWeight="Bold"
                          HorizontalAlignment="Left">
                    <TextBlock.Foreground>
                        <LinearGradientBrush StartPoint="0,0" EndPoint="1,0">
                            <GradientStop Color="#FFFF6B9D" Offset="0"/>
                            <GradientStop Color="#FFFF8E53" Offset="1"/>
                        </LinearGradientBrush>
                    </TextBlock.Foreground>
                </TextBlock>
                
                <StackPanel HorizontalAlignment="Right" Orientation="Horizontal">
                    <!-- æ¨¡åž‹ä¸‹è½½è¿›åº¦ -->
                    <StackPanel Orientation="Horizontal" 
                               Visibility="{Binding IsDownloadingModel, Converter={StaticResource BooleanToVisibilityConverter}}">
                        <ProgressBar Width="100" Height="8" Margin="0,0,8,0"
                                    Maximum="100"
                                    Value="{Binding ModelDownloadProgress}"/>
                        <TextBlock Text="{Binding ModelDownloadProgress, StringFormat='{}{0:F1}%'}" 
                                  Foreground="#FFFF6B9D"
                                  FontSize="11"
                                  VerticalAlignment="Center"
                                  Margin="0,0,10,0"/>
                    </StackPanel>
                    
                    <Ellipse Width="10" Height="10" Margin="5,0">
                        <Ellipse.Style>
                            <Style TargetType="Ellipse">
                                <Setter Property="Fill" Value="#FF555555"/>
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding CurrentState}" Value="Recording">
                                        <Setter Property="Fill" Value="#FFFF4444"/>
                                        <DataTrigger.EnterActions>
                                            <BeginStoryboard>
                                                <Storyboard RepeatBehavior="Forever">
                                                    <DoubleAnimation Storyboard.TargetProperty="Opacity"
                                                                   From="1" To="0.3" Duration="0:0:0.5"
                                                                   AutoReverse="True"/>
                                                </Storyboard>
                                            </BeginStoryboard>
                                        </DataTrigger.EnterActions>
                                    </DataTrigger>
                                    <DataTrigger Binding="{Binding IsModelLoaded}" Value="True">
                                        <Setter Property="Fill" Value="#FF00D4AA"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </Ellipse.Style>
                    </Ellipse>
                    <TextBlock Text="{Binding StatusMessage}"
                              Foreground="#FFAAAAAA"
                              FontSize="11"
                              VerticalAlignment="Center"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- è®¾å¤‡é€‰æ‹©åŒºåŸŸ -->
        <Border Grid.Row="1" Padding="15,8" Background="#11000000">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <TextBlock Grid.Column="0" 
                          Text="ðŸŽ§ éŸ³é¢‘æº:" 
                          VerticalAlignment="Center"
                          Foreground="#FFCCCCCC"
                          FontSize="12"
                          Margin="0,0,10,0"/>

                <ComboBox Grid.Column="1" 
                         ItemsSource="{Binding AudioDevices}"
                         SelectedItem="{Binding SelectedDevice}"
                         DisplayMemberPath="Name"
                         Background="#22FFFFFF"
                         Foreground="Black"
                         BorderBrush="#44FFFFFF"
                         Padding="8,5"
                         FontSize="12"/>

                <TextBlock Grid.Column="2" 
                          Text="ðŸŒ ç¿»è¯‘:" 
                          VerticalAlignment="Center"
                          Foreground="#FFCCCCCC"
                          FontSize="12"
                          Margin="15,0,10,0"/>

                <StackPanel Grid.Column="3" Orientation="Horizontal">
                    <ComboBox ItemsSource="{Binding TranslationProviders}"
                             SelectedItem="{Binding SelectedTranslationProvider}"
                             DisplayMemberPath="Name"
                             Background="#22FFFFFF"
                             Foreground="Black"
                             BorderBrush="#44FFFFFF"
                             Padding="8,5"
                             FontSize="12"
                             Width="150"/>
                    <Button Content="ðŸ”„"
                           Command="{Binding RefreshOllamaModelsCommand}"
                           Style="{StaticResource AnimeButton}"
                           Padding="5,2"
                           FontSize="11"
                           Margin="5,0,0,0"
                           ToolTip="åˆ·æ–°Ollamaæ¨¡åž‹åˆ—è¡¨"/>
                </StackPanel>

                <StackPanel Grid.Column="4" Orientation="Horizontal" Margin="10,0,0,0">
                    <TextBlock Text="ðŸ“" FontSize="14" VerticalAlignment="Center"/>
                    <TextBlock Text="{Binding SaveDirectory, StringFormat='{}{0:...\\:0,20}'}"
                              Foreground="#FFAAAAAA"
                              FontSize="11"
                              VerticalAlignment="Center"
                              Margin="5,0,10,0"
                              MaxWidth="150"
                              TextTrimming="CharacterEllipsis"/>
                    <Button Content="æ›´æ”¹"
                           Command="{Binding ChangeSaveDirectoryCommand}"
                           Style="{StaticResource AnimeButton}"
                           Padding="10,5"
                           FontSize="11"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- æŽ§åˆ¶é¢æ¿ -->
        <Border Grid.Row="2" Padding="15,10" Background="#0D000000">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- å½•åˆ¶æŽ§åˆ¶ -->
                <StackPanel Grid.Column="0" Orientation="Horizontal">
                    <Button Style="{StaticResource RecordButton}"
                            Command="{Binding StartRecordingCommand}"
                            Visibility="{Binding CurrentState, Converter={StaticResource RecordingStateToVisibilityConverter}, ConverterParameter=Idle}">
                        <TextBlock Text="ðŸ”´" FontSize="28"/>
                    </Button>
                    
                    <Button Style="{StaticResource RecordButton}"
                            Background="#FF444444"
                            Command="{Binding StopRecordingCommand}"
                            Visibility="{Binding CurrentState, Converter={StaticResource RecordingStateToVisibilityConverter}, ConverterParameter=Recording}">
                        <TextBlock Text="â¹ï¸" FontSize="22"/>
                    </Button>
                    
                    <StackPanel Margin="15,0,0,0" VerticalAlignment="Center" Width="120">
                        <TextBlock Text="{Binding SelectedDevice.Name, FallbackValue='æœªé€‰æ‹©'}" 
                                  Foreground="#FFCCCCCC"
                                  FontSize="12"
                                  TextTrimming="CharacterEllipsis"/>
                        <ProgressBar Style="{StaticResource AudioLevelBar}"
                                    Maximum="100"
                                    Value="{Binding AudioLevel}"
                                    Margin="0,5,0,0"/>
                    </StackPanel>
                </StackPanel>

                <!-- åŠŸèƒ½æŒ‰é’® -->
                <StackPanel Grid.Column="2" Orientation="Horizontal">
                    <Button Style="{StaticResource AnimeButton}"
                            Command="{Binding ToggleTranslationCommand}"
                            Margin="8,0">
                        <TextBlock>
                            <TextBlock.Style>
                                <Style TargetType="TextBlock">
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding EnableTranslation}" Value="True">
                                            <Setter Property="Text" Value="ðŸŒ ç¿»è¯‘ ON"/>
                                        </DataTrigger>
                                        <DataTrigger Binding="{Binding EnableTranslation}" Value="False">
                                            <Setter Property="Text" Value="ðŸŒ ç¿»è¯‘ OFF"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </TextBlock.Style>
                        </TextBlock>
                    </Button>
                    
                    <Button Style="{StaticResource AnimeButton}"
                            Command="{Binding ClearTranscriptCommand}"
                            Margin="8,0"
                            Background="#FF667eea">
                        <TextBlock Text="ðŸ—‘ï¸ æ¸…ç©º"/>
                    </Button>
                    
                    <Button Style="{StaticResource AnimeButton}"
                            Command="{Binding SaveTranscriptCommand}"
                            Margin="8,0,0,0">
                        <TextBlock Text="ðŸ’¾ ä¿å­˜"/>
                    </Button>
                </StackPanel>
            </Grid>
        </Border>

        <!-- å­—å¹•æ˜¾ç¤ºåŒºåŸŸ -->
        <Border Grid.Row="3" Margin="10" CornerRadius="15"
                Background="#0D000000"
                BorderBrush="#22FFFFFF"
                BorderThickness="1">
            <Grid>
                <ScrollViewer VerticalScrollBarVisibility="Auto"
                             HorizontalScrollBarVisibility="Disabled">
                    <StackPanel>
                        <ItemsControl ItemsSource="{Binding TranscriptSegments}"
                                     ItemTemplate="{StaticResource TranscriptItemTemplate}">
                            <ItemsControl.ItemsPanel>
                                <ItemsPanelTemplate>
                                    <StackPanel/>
                                </ItemsPanelTemplate>
                            </ItemsControl.ItemsPanel>
                        </ItemsControl>
                    </StackPanel>
                </ScrollViewer>
                
                <!-- ç©ºçŠ¶æ€æç¤º -->
                <TextBlock Text="ðŸŽµ å¼€å§‹å½•éŸ³åŽä¼šåœ¨è¿™é‡Œæ˜¾ç¤ºå­—å¹•~" 
                          HorizontalAlignment="Center"
                          VerticalAlignment="Center"
                          Foreground="#44FFFFFF"
                          FontSize="14">
                    <TextBlock.Style>
                        <Style TargetType="TextBlock">
                            <Setter Property="Visibility" Value="Collapsed"/>
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding TranscriptSegments.Count}" Value="0">
                                    <Setter Property="Visibility" Value="Visible"/>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </TextBlock.Style>
                </TextBlock>
            </Grid>
        </Border>

        <!-- åº•éƒ¨çŠ¶æ€æ  -->
        <Border Grid.Row="4" Padding="12,8" Background="#11000000">
            <Grid>
                <TextBlock Text="âœ¨ æ”¯æŒéº¦å…‹é£Ž/ç³»ç»Ÿå£°éŸ³ | å®žæ—¶è¯†åˆ«ç¿»è¯‘" 
                          Foreground="#55FFFFFF"
                          FontSize="10"
                          HorizontalAlignment="Left"/>
                <TextBlock Text="ðŸ“‚ è‡ªåŠ¨ä¿å­˜åˆ°æŒ‡å®šæ–‡ä»¶å¤¹" 
                          Foreground="#55FFFFFF"
                          FontSize="10"
                          HorizontalAlignment="Right">
                    <TextBlock.Style>
                        <Style TargetType="TextBlock">
                            <Setter Property="Visibility" Value="Collapsed"/>
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding AutoSave}" Value="True">
                                    <Setter Property="Visibility" Value="Visible"/>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </TextBlock.Style>
                </TextBlock>
            </Grid>
        </Border>
    </Grid>
</Window>
